<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Se7enZçš„åšå®¢æ–‡ç« è¯¦æƒ…">
    <title>Article | Se7enZ</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
    <script>
        // é˜²æ­¢ä¸»é¢˜åˆ‡æ¢é—ªçƒï¼šåœ¨é¡µé¢æ¸²æŸ“å‰ç«‹å³åº”ç”¨ä¸»é¢˜
        (function() {
            try {
                const theme = localStorage.getItem('theme');
                const isDark = theme === 'dark';
                if (isDark) {
                    document.documentElement.classList.add('dark-mode');
                    // å¦‚æœ body å·²åŠ è½½ï¼Œä¹Ÿç«‹å³æ·»åŠ ç±»
                    if (document.body) {
                        document.body.classList.add('dark-mode');
                    }
                }
            } catch (e) {}
        })();
    </script>
    <script>
        // æå‰è®¾ç½® Highlight.js ä¸»é¢˜ï¼Œé˜²æ­¢ä»£ç å—é—ªçƒ
        (function() {
            try {
                const theme = localStorage.getItem('theme');
                const isDark = theme === 'dark';
                const hljsThemeHref = isDark 
                    ? 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css'
                    : 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
                var link = document.createElement('link');
                link.id = 'hljs-theme';
                link.rel = 'stylesheet';
                link.href = hljsThemeHref;
                document.head.appendChild(link);
            } catch (e) {}
        })();
    </script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <div id="header"></div>

    <div class="container">
        <main id="app">
            <div v-if="loading" class="card loading-skeleton">
                <p>æ­£åœ¨æ·±åº¦è§£ææ–‡ç« å†…å®¹...</p>
            </div>

            <div v-else-if="!post" class="card error-container">
                <span class="post-detail-error-icon">âš ï¸</span>
                <h2>æœªæ‰¾åˆ°è¯¥æ–‡ç« </h2>
                <p class="post-detail-error-message">è¯·æ£€æŸ¥æ–‡ç«  ID æ˜¯å¦æ­£ç¡®æˆ–æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p>
                <a href="blog.html" class="project-link post-detail-error-link">è¿”å›åšå®¢åˆ—è¡¨</a>
            </div>

            <article v-else class="card fade-in">
                <header class="post-detail-header">
                    <h1 class="post-detail-title">{{ post.title }}</h1>
                    <div class="post-detail-meta">
                        <span>ğŸ“… å‘å¸ƒæ—¥æœŸï¼š{{ post.date }}</span>
                        <span>ğŸ·ï¸ åˆ†ç±»ï¼š{{ post.category }}</span>
                    </div>
                </header>

                <div class="markdown-body" v-html="renderedContent"></div>

                <footer class="post-detail-footer">
                    <a href="blog.html" class="project-link post-detail-back-link">
                        â† è¿”å›åˆ—è¡¨
                    </a>
                </footer>
            </article>
        </main>
    </div>

    <div id="footer"></div>

    <script src="js/main.js"></script>

    <script>
        const { createApp, ref, onMounted, computed, nextTick } = Vue;

        createApp({
            setup() {
                const post = ref(null);
                const markdownRaw = ref("");
                const loading = ref(true);

                onMounted(async () => {
                    try {
                        // 1. è·å– URL ä¸­çš„ ID å‚æ•°
                        const params = new URLSearchParams(window.location.search);
                        const idFromUrl = params.get('id');
                        
                        if (!idFromUrl) {
                            loading.value = false;
                            return;
                        }

                        // 2. åŠ è½½æ–‡ç« ç´¢å¼•
                        const resIndex = await fetch('data/posts.json');
                        if (!resIndex.ok) throw new Error("æ— æ³•åŠ è½½æ–‡ç« ç´¢å¼•");
                        
                        const posts = await resIndex.json();
                        
                        // 3. æŸ¥æ‰¾æ–‡ç«  (å¼ºåˆ¶å°† idFromUrl è½¬ä¸ºæ•°å­—è¿›è¡Œå¯¹æ¯”)
                        const foundPost = posts.find(p => p.id === Number(idFromUrl));

                        if (foundPost) {
                            post.value = foundPost;
                            
                            // 4. åŠ è½½ Markdown æ–‡ä»¶
                            const resContent = await fetch(foundPost.path);
                            if (resContent.ok) {
                                markdownRaw.value = await resContent.text();
                            } else {
                                markdownRaw.value = "# ğŸ˜… å†…å®¹åŠ è½½å¤±è´¥\næŠ±æ­‰ï¼Œè¯¥æ–‡ç« çš„ Markdown æ–‡ä»¶è·¯å¾„ï¼ˆ" + foundPost.path + "ï¼‰æ— æ³•è®¿é—®ã€‚";
                            }
                        }
                    } catch (err) {
                        console.error('è¯¦æƒ…é¡µåˆå§‹åŒ–é”™è¯¯:', err);
                    } finally {
                        loading.value = false;
                        
                        // 5. ç­‰å¾…å†…å®¹æ¸²æŸ“åæ‰§è¡Œä»£ç é«˜äº®
                        await nextTick();
                        document.querySelectorAll('pre code').forEach((block) => {
                            hljs.highlightElement(block);
                        });
                    }
                });

                // ä½¿ç”¨è®¡ç®—å±æ€§å°† Markdown è½¬ä¸º HTML
                const renderedContent = computed(() => {
                    if (!markdownRaw.value) return "";
                    // é…ç½® markedï¼ˆå¯é€‰ï¼‰
                    marked.setOptions({
                        breaks: true, // æ”¯æŒæ¢è¡Œç¬¦
                        gfm: true     // å¯ç”¨ GitHub é£æ ¼çš„ Markdown
                    });
                    return marked.parse(markdownRaw.value);
                });

                return { post, loading, renderedContent };
            }
        }).mount('#app');
    </script>
</body>
</html>